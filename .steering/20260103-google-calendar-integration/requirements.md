# 要求定義書

## 概要

Slack で Mynion に話しかけることで、ユーザーの Google カレンダーを操作できるようにする。

## 関連 Issue

- GitHub Issue: [#3 Googleカレンダー操作をエージェントができるようにしたい](https://github.com/foie0222/mynion/issues/3)

## ユーザーストーリー

### 予定確認

**As a** Slack ユーザー
**I want to** Mynion に「今日の予定は？」と聞く
**So that** Google カレンダーの予定を確認できる

### 予定登録

**As a** Slack ユーザー
**I want to** Mynion に「明日10時にミーティングを入れて」と指示する
**So that** Google カレンダーに予定を登録できる

### 予定更新

**As a** Slack ユーザー
**I want to** Mynion に「午後のミーティングを15時に変更して」と指示する
**So that** 既存の予定を更新できる

### 予定削除

**As a** Slack ユーザー
**I want to** Mynion に「明日のランチミーティングをキャンセルして」と指示する
**So that** 予定を削除できる

### 初回 OAuth 認証

**As a** 初めてカレンダー機能を使うユーザー
**I want to** 認証リンクが表示されて Google アカウントを連携する
**So that** 以降は認証なしでカレンダーを操作できる

## 機能要件

### F1: 予定取得 (`get_events`)

| 項目 | 内容 |
|------|------|
| 入力 | 開始日（必須）、終了日（オプション） |
| 出力 | 予定一覧（タイトル、開始時刻、終了時刻） |
| 備考 | 終了日省略時は開始日の当日のみ |

### F2: 予定作成 (`create_event`)

| 項目 | 内容 |
|------|------|
| 入力 | タイトル（必須）、開始日時（必須）、終了日時（オプション）、説明（オプション） |
| 出力 | 作成された予定の情報 |
| 備考 | 終了日時省略時は開始から1時間 |

### F3: 予定更新 (`update_event`)

| 項目 | 内容 |
|------|------|
| 入力 | イベントID（必須）、更新フィールド |
| 出力 | 更新後の予定情報 |
| 備考 | 指定フィールドのみ更新 |

### F4: 予定削除 (`delete_event`)

| 項目 | 内容 |
|------|------|
| 入力 | イベントID（必須） |
| 出力 | 削除成功メッセージ |
| 備考 | 削除前の確認は Agent が自然言語で行う |

## 非機能要件

### セキュリティ

- OAuth2 トークンは AgentCore Identity Token Vault で管理
- Gateway への Inbound 認証は CUSTOM_JWT（Cognito OAuth トークン）
- Lambda は最小権限の IAM ロール

### パフォーマンス

- カレンダー操作: 10秒以内に完了

## 受け入れ条件

1. Slack で「今日の予定を教えて」と言うと、Google カレンダーの予定が返る
2. Slack で「明日10時にミーティングを入れて」と言うと、予定が作成される
3. 初回利用時は OAuth 認証リンクが表示され、認証後に再度リクエストすると動作する
4. 認証済みユーザーは再認証なしでカレンダー操作ができる

## 制約事項

### 完了済みの設定

- Google Cloud: OAuth 同意画面、クライアント ID 作成済み
- AgentCore Identity: Google OAuth2 Credential Provider 登録済み

### スコープ外

- 複数カレンダーの切り替え（プライマリカレンダーのみ対象）
- 定期予定の個別編集
- 添付ファイル操作
- 会議室予約
